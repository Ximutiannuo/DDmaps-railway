# 工地交通调度系统 - 管理端使用说明书

## 目录

1. [系统简介](#系统简介)
2. [快速开始](#快速开始)
3. [界面介绍](#界面介绍)
4. [功能详解](#功能详解)
5. [操作流程](#操作流程)
6. [常见问题](#常见问题)

---

## 系统简介

工地交通调度系统管理端是系统的核心控制界面，提供了完整的路网管理、车辆调度、实时监控、数据分析等功能。通过Web界面，管理员可以轻松管理整个工地的交通调度系统。

### 主要功能模块

- 🚗 **车辆调度**：添加车辆、设置起点终点、实时调度管理
- 🗺️ **地图设置**：导入DXF地图、管理节点和道路、GPS坐标管理
- 📊 **路网信息**：查看节点和道路统计、道路状态管理
- 📈 **实时监控**：车辆位置实时追踪、拥堵状态监控、系统状态查看
- 🚛 **车辆配置**：车辆类型管理、速度配置
- 📅 **行驶时间库**：历史数据查看、统计分析
- 👨‍✈️ **司机入口**：司机管理、路线预览

---

## 快速开始

### 访问系统

1. 在浏览器中打开系统地址（例如：`http://localhost:5000` 或服务器IP地址）
2. 首次访问会自动初始化默认路网数据
3. 系统界面分为左侧控制面板和右侧地图区域

### 首次使用流程

1. **导入或创建路网**：在"地图设置"标签页导入DXF文件或手动添加节点和道路
2. **配置节点**：设置节点的GPS坐标、类型等信息
3. **添加车辆**：在"车辆调度"标签页添加车辆
4. **开始调度**：点击"开始调度"按钮启动实时调度

---

## 界面介绍

### 左侧控制面板

控制面板包含以下标签页：

- **车辆调度**：车辆管理、调度控制
- **地图设置**：地图导入、节点道路管理
- **路网信息**：路网数据统计、道路状态控制
- **实时监控**：车辆监控、系统状态
- **车辆配置**：车辆类型配置
- **行驶时间库**：历史数据管理
- **司机入口**：司机管理

### 右侧地图区域

- **地图显示区**：显示路网、节点、道路、车辆位置
- **控制按钮**：编辑模式、标签显示、图例等
- **缩放控制**：鼠标滚轮或按钮缩放地图

---

## 功能详解

### 一、车辆调度

#### 1.1 添加车辆

1. 切换到"车辆调度"标签页
2. 填写车辆信息：
   - **车辆ID**：留空则自动编号
   - **车辆类型**：渣土车、材料车、工程车、特种车
   - **载重（吨）**：车辆载重限制
   - **宽度（米）**：车辆宽度
   - **起点节点**：从下拉列表选择
   - **目标区域**：从下拉列表选择
3. 点击"添加车辆"按钮
4. 车辆会显示在地图上，并自动计算最优路径

#### 1.2 当前车辆管理

- **车辆列表**：显示所有已添加的车辆
- **手动重算路径**：为所有车辆重新计算路径
- **按效率排序**：按路径效率对车辆进行排序
- **删除车辆**：点击车辆列表中的删除按钮

#### 1.3 调度控制

- **开始调度**：启动车辆自动调度，车辆会按照计算的路径移动
- **重置系统**：清空所有车辆数据，重置系统状态

---

### 二、地图设置

#### 2.1 自定义地图

**上传地图背景**：
1. 点击上传区域或直接拖拽图片文件
2. 支持 JPG、PNG 格式，建议尺寸 800x600 以上
3. 上传后地图会自动作为底图显示
4. 点击"清除自定义地图"按钮可删除底图

**注意**：仅替换底图，不会修改路网节点和道路数据。

#### 2.2 导入 DXF 路网

**准备工作**：
- DXF文件需要包含道路中心线图层
- 图层名称应为"道路中心线"或线型为 `JIS_08_37`（主路）、`JIS_08_50`（支路）

**导入步骤**：
1. 点击上传区域或拖拽DXF文件
2. 点击"导入DXF路网"按钮
3. 系统会自动解析节点和道路
4. 导入完成后，地图会显示新的路网

**DXF转JSON功能**：
- 点击"DXF转JSON并下载"按钮
- 可将DXF文件转换为JSON格式
- 转换后的JSON文件可用于备份或分享

**⚠️ 重要提示**：导入DXF会覆盖现有节点与道路，请提前备份数据。

#### 2.3 JSON路网管理

**导入JSON路网**：
1. 点击上传区域或拖拽JSON文件
2. 点击"导入JSON路网"按钮
3. 系统会加载JSON中的节点和道路数据

**导出JSON路网**：
1. 点击"导出当前路网为JSON"按钮
2. 系统会下载当前路网的JSON文件
3. 可用于备份或在不同系统间迁移

#### 2.4 地图拖动控制

- 点击"地图拖动"按钮切换拖动模式
- **开启**：可以拖动整个地图（包括节点、道路等所有元素）
- **关闭**：只能通过缩放和平移查看地图

#### 2.5 地图缩放控制

- **放大（+）**：点击放大按钮或使用鼠标滚轮向上滚动
- **缩小（-）**：点击缩小按钮或使用鼠标滚轮向下滚动
- **重置**：点击重置按钮恢复默认缩放比例
- 当前缩放比例显示在按钮下方（例如：100%）

#### 2.6 节点管理

**节点列表**：
- 显示所有节点的名称、ID、类型、坐标
- 可以编辑节点名称
- 可以删除节点

**添加节点**：
1. 选择节点类型：
   - **进场口**（绿色）：工地入口节点
   - **交叉口**（蓝色）：道路交叉点
   - **作业区**（红色）：作业区域节点
   - **场外起点**（紫色）：场外起始点
2. 输入节点名称（例如：进场口1）
3. 点击"添加节点"按钮
4. 然后在地图上点击位置放置节点

**节点显示控制**：
- **显示隐藏的节点**：勾选后，所有隐藏的节点会以红色虚线边框高亮显示
- **显示支路节点**：勾选后，会显示支路与支路相交的节点（线型为JIS_08_50的道路）

**节点操作**：
- **设置节点状态**：点击节点，在弹出菜单中选择拥堵级别（正常、轻微拥堵、中度拥堵、严重拥堵）
- **显示/隐藏节点**：在节点状态菜单中可以设置节点的显示状态
- **编辑节点名称**：双击节点可编辑名称
- **拖动节点**：开启编辑模式后，可以拖动节点调整位置
- **同步节点位置到后端**：点击按钮将地图上的节点位置同步到服务器
- **清除所有节点**：删除所有节点（⚠️ 谨慎操作，此操作不可撤销）

**GPS坐标管理**：
- **导出GPS坐标**：将所有节点的GPS坐标导出为Excel文件（.xlsx格式）
- **导入GPS坐标**：从Excel文件批量导入GPS坐标
- **格式要求**：节点ID、节点名称、纬度、经度

#### 2.7 地图文字框

系统支持在地图上添加文字标注：

1. **开启编辑模式**：点击地图右侧控制面板的"编辑模式"按钮
2. **添加文字框**：在地图空白处点击，会弹出编辑对话框
3. **编辑内容**：输入文字、设置字体、颜色、大小等
4. **移动位置**：拖动文字框到合适位置
5. **编辑文字框**：双击文字框可重新编辑
6. **删除文字框**：在文字框列表中点击删除按钮

#### 2.8 道路管理

**添加道路**：
1. 选择起点节点和终点节点
2. 设置道路长度（米）
3. 选择道路方向：
   - **双向通行**：车辆可以双向行驶
   - **单向通行**：选择方向（北、南、东、西、东北、西北、东南、西南）
4. 点击"添加道路"按钮

**道路操作**：
- **设置道路状态**：在"路网信息"标签页选择道路并设置状态
- **编辑道路名称**：双击道路可编辑名称
- **清除所有道路**：删除所有道路（⚠️ 谨慎操作）

---

### 三、路网信息

#### 3.1 路网概览

显示系统统计信息：
- 节点总数
- 道路总数
- 车辆总数
- 系统运行状态

#### 3.2 道路状态控制

**设置道路状态**：
1. 在"选择道路"下拉列表中选择道路
2. 点击状态按钮：
   - **正常**（绿色）：道路可正常通行
   - **拥堵**（红色）：道路可用但拥堵，车辆会尝试绕行
   - **占道施工**（橙色）：道路可用但高拥堵，通行缓慢
   - **封闭**（灰色）：道路不可通行，车辆必须绕行

**节点拥堵控制**：
1. 点击地图上的节点
2. 在弹出菜单中选择拥堵级别：
   - **正常**：无拥堵
   - **轻微拥堵**：轻微影响通行
   - **中度拥堵**：明显影响通行
   - **严重拥堵**：严重影响通行

**说明**：节点拥堵会影响所有与该节点相连的道路，拥堵级别越高影响越大。

---

### 四、实时监控

#### 4.1 车辆监控

- **车辆列表**：显示所有车辆的实时信息
  - 车辆ID和类型
  - 当前位置坐标
  - 目标节点
  - 路径效率
- **车辆位置**：在地图上实时显示车辆位置（红色圆点）
- **车辆路径**：显示车辆的规划路径（蓝色线条）

#### 4.2 系统状态

- **节点状态**：显示各节点的拥堵情况
- **道路状态**：显示各道路的通行状态
- **施工区域**：显示正在施工的区域

#### 4.3 数据图表

- **效率趋势图**：显示系统整体效率变化
- **车辆类型分布**：显示不同类型车辆的数量分布
- **拥堵热力图**：显示道路拥堵情况的热力图

---

### 五、车辆配置

#### 5.1 车辆类型管理

可以配置不同类型车辆的默认速度：
- 渣土车
- 材料车
- 工程车
- 特种车

#### 5.2 速度配置

为每种车辆类型设置默认速度（km/h）：
1. 选择车辆类型
2. 输入默认速度
3. 点击保存

---

### 六、行驶时间库

#### 6.1 历史数据查看

- 查看所有历史行驶记录
- 按时间、司机、路线等条件筛选
- 显示行驶时间、距离、平均速度等信息

#### 6.2 统计分析

- 路线统计数据
- 平均行驶时间
- 平均行驶距离
- 平均速度

#### 6.3 数据管理

- **导出数据**：导出历史数据为JSON格式
- **清除数据**：按条件清除历史数据
  - 全部清除
  - 按日期清除
  - 按司机ID清除
  - 按车辆类型清除

---

### 七、司机入口

#### 7.1 司机管理

**司机列表**：
- 显示所有已注册的司机
- 显示司机ID、姓名、车牌号、车辆类型等信息
- 显示最后活跃时间

**注册司机**：
1. 输入司机ID（例如：D001）
2. 填写司机信息：
   - 姓名
   - 车牌号
   - 联系电话
   - 车辆类型
   - 载重（吨）
   - 宽度（米）
   - 默认起点节点
   - 默认终点节点
3. 点击"注册司机"按钮

#### 7.2 路线预览

**预览司机路线**：
1. 选择起点节点和终点节点
2. 选择车辆类型、载重、宽度
3. 点击"预览路线"按钮
4. 系统会显示规划的路线和预计时间

**路径预测**：
- 输入起点和终点节点
- 选择规划算法（系统推荐或深度学习DQN）
- 系统会显示预测的路径和预计时间

---

## 操作流程

### 完整工作流程示例

#### 场景：新建工地，配置路网并开始调度

1. **导入地图**
   - 切换到"地图设置"标签页
   - 上传工地地图图片作为底图
   - 导入DXF路网文件（如果有）

2. **配置节点**
   - 添加关键节点（进场口、作业区等）
   - 为节点设置GPS坐标（通过导入或手动输入）
   - 设置节点类型和名称

3. **配置道路**
   - 连接节点创建道路
   - 设置道路方向（单向/双向）
   - 设置道路状态

4. **添加车辆**
   - 切换到"车辆调度"标签页
   - 添加需要调度的车辆
   - 设置起点和终点

5. **开始调度**
   - 检查车辆和路网配置
   - 点击"开始调度"按钮
   - 在"实时监控"标签页观察车辆运行

6. **监控和管理**
   - 实时查看车辆位置和状态
   - 根据实际情况调整道路状态和节点拥堵级别
   - 查看统计数据和分析报告

---

## 常见问题

### Q1: 如何备份路网数据？

**A**: 在"地图设置"标签页点击"导出当前路网为JSON"按钮，下载JSON文件即可备份。

### Q2: 导入DXF后节点位置不对怎么办？

**A**: 可以开启编辑模式，拖动节点调整位置，然后点击"同步节点位置到后端"按钮保存。

### Q3: 如何设置道路为单向通行？

**A**: 在"地图设置"标签页的"道路管理"部分，添加道路时选择道路方向（如"北向单行"）。

### Q4: 车辆不移动怎么办？

**A**: 检查以下几点：
- 是否点击了"开始调度"按钮
- 起点和终点是否正确设置
- 道路是否正常（未被封闭）
- 查看浏览器控制台是否有错误信息

### Q5: 如何隐藏不需要显示的节点？

**A**: 
1. 点击要隐藏的节点
2. 在弹出菜单中点击"隐藏节点"
3. 如需重新显示，勾选"显示隐藏的节点"复选框，然后点击节点选择"显示节点"

### Q6: 如何显示支路节点？

**A**: 在"地图设置"标签页的"节点管理"部分，勾选"显示支路节点（JIS_08_50）"复选框。

### Q7: GPS坐标如何导入？

**A**: 
1. 在"节点管理"部分点击"📤 导入GPS坐标 (XLSX)"按钮
2. 选择Excel文件（格式：节点ID、节点名称、纬度、经度）
3. 系统会自动导入GPS坐标

### Q8: 如何清除历史行驶数据？

**A**: 在"行驶时间库"标签页点击"清除训练数据"按钮，可以选择全部清除或按条件清除。

---

## 技术支持

如遇到问题，请：
1. 查看浏览器控制台（F12）的错误信息
2. 检查网络连接是否正常
3. 联系系统管理员

---

**版本**: v1.0  
**更新日期**: 2024年12月

