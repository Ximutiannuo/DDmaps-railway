# 工地交通调度系统 - 司机端使用说明书

## 目录

1. [系统简介](#系统简介)
2. [快速开始](#快速开始)
3. [界面介绍](#界面介绍)
4. [功能详解](#功能详解)
5. [操作流程](#操作流程)
6. [常见问题](#常见问题)

---

## 系统简介

司机端是专为工地司机设计的移动端界面，提供路线规划、GPS定位、实时导航等功能。司机可以通过手机或平板电脑访问系统，获取最优行驶路线，提高运输效率。

### 主要功能

- 🗺️ **路线规划**：智能计算最优行驶路线
- 📍 **GPS定位**：实时获取当前位置并自动规划路线
- 🚗 **路线预览**：查看详细路线信息和预计时间
- 📱 **多语言支持**：支持中文、英文、俄文三种语言
- 🔄 **实时更新**：自动更新路网信息和车辆位置

---

## 快速开始

### 访问系统

1. 在手机或平板电脑的浏览器中打开系统地址
   - 例如：`http://服务器地址/driver`
2. 首次访问会自动加载路网数据
3. 界面会自动适配移动端屏幕

### 首次使用流程

1. **注册司机信息**（如未注册）
   - 输入司机ID
   - 填写个人和车辆信息
   - 点击"注册"按钮

2. **选择起点和终点**
   - 从下拉列表选择，或
   - 点击"📍 定位"按钮使用GPS位置作为起点
   - 在地图上直接点击节点选择终点

3. **计算路线**
   - 点击"计算最优路线"按钮
   - 系统会显示规划好的路线和预计时间

---

## 界面介绍

### 顶部控制栏

- **语言切换**：点击语言按钮切换界面语言（中文/英文/俄文）
- **缩放控制**：放大/缩小地图

### 左侧控制面板

包含以下功能区域：
- **路线规划**：起点终点选择、路线计算
- **路线结果**：显示规划的路线详情
- **车辆信息**：显示当前车辆信息
- **历史记录**：显示历史行驶记录

### 右侧地图区域

- **地图显示**：显示路网、节点、道路、规划路线
- **车辆位置**：实时显示车辆在地图上的位置（GPS模式）

---

## 功能详解

### 一、路线规划

#### 1.1 选择起点

**方法一：从下拉列表选择**
1. 点击"起点"下拉列表
2. 从列表中选择起点节点

**方法二：使用GPS定位（推荐）**
1. 点击"📍 定位"按钮
2. 允许浏览器访问您的位置信息
3. 系统会自动找到最近的节点作为起点
4. 起点选择框会显示"📍 当前位置（GPS）"

**GPS定位说明**：
- 首次使用需要在浏览器中允许位置权限
- GPS定位精度取决于设备性能和环境
- 如果定位失败，请检查GPS功能是否开启

#### 1.2 选择终点

**方法一：从下拉列表选择**
1. 点击"终点"下拉列表
2. 从列表中选择终点节点

**方法二：在地图上点击节点（推荐）**
1. 在地图上找到目标节点
2. 直接点击节点
3. 系统会自动将该节点设置为终点
4. 显示提示："已选择终点: [节点名称]"

**提示**：节点上会显示节点编号，鼠标悬停会显示节点名称。

#### 1.3 规划算法选择

系统提供两种路径规划算法：

- **系统推荐（默认）**：基于Dijkstra算法的经典路径规划，稳定可靠
- **深度学习（DQN）**：基于深度强化学习的智能路径规划（实验性功能）
  - 需要后台已训练模型
  - 可以设置探索率（ε值，0-1之间）
  - 探索率越大，路径越随机

#### 1.4 车辆信息设置

- **车辆类型**：选择车辆类型（渣土车、材料车等）
- **载重（吨）**：输入车辆载重
- **宽度（米）**：输入车辆宽度
- **速度（km/h）**：可选的车辆速度（留空使用默认速度）

这些信息会影响路径规划，系统会考虑车辆限制选择合适路线。

#### 1.5 计算路线

1. 确认起点和终点已选择
2. 确认车辆信息已填写
3. 点击"计算最优路线"按钮
4. 系统会显示计算进度
5. 计算完成后，地图上会显示规划好的路线

---

### 二、路线结果

#### 2.1 路线信息显示

计算完成后，会显示以下信息：

- **起点**：起始节点名称
- **终点**：目标节点名称
- **预计时间**：预计行驶时间（分钟）
- **路径节点**：路线经过的节点列表
- **路径详情**：显示详细的路径信息

#### 2.2 地图显示

- **路线高亮**：规划的路线会在地图上以蓝色线条高亮显示
- **起点标记**：绿色标记表示起点
- **终点标记**：红色标记表示终点
- **路径节点**：路线经过的节点会特殊标记

#### 2.3 提交路线

计算路线后，可以：
- **查看路线详情**：点击"查看详情"查看完整路径信息
- **重新计算**：修改起点或终点后重新计算
- **提交路线**：将路线提交到系统（如果已注册司机）

---

### 三、GPS实时定位

#### 3.1 启用GPS定位

1. 点击"📍 定位"按钮
2. 允许浏览器访问位置信息
3. 系统会实时获取GPS坐标
4. 在地图上显示当前位置（绿色标记）

#### 3.2 GPS道路吸附

系统具有智能道路吸附功能：
- 当GPS坐标接近道路（约5米内）时，会自动吸附到道路上
- 优先吸附到主路段（JIS_08_37）
- 车辆位置会沿着道路移动，更加准确

#### 3.3 实时位置更新

- GPS位置会实时更新（每2秒更新一次）
- 位置变化会自动同步到系统
- 地图上会显示实时位置标记

**GPS模式说明**：
- GPS模式下，车辆位置由GPS坐标控制
- 系统会自动将GPS坐标转换为地图坐标
- 如果GPS信号不佳，建议手动选择起点

---

### 四、车辆信息

#### 4.1 查看车辆信息

如果已注册司机并提交路线，可以查看：
- 车辆ID
- 车辆类型
- 当前位置
- 目标节点
- 行驶进度

#### 4.2 实时位置追踪

- 在地图上实时显示车辆位置
- 显示车辆移动轨迹
- 显示到达目标节点的距离和预计时间

---

### 五、历史记录

#### 5.1 查看历史路线

- 显示所有历史计算的路线
- 显示路线起点和终点
- 显示预计时间和实际时间（如果有）

#### 5.2 路线统计

- 查看常用路线
- 查看平均行驶时间
- 查看行驶效率

---

## 操作流程

### 完整使用流程示例

#### 场景：从工地入口到作业区

1. **打开系统**
   - 在手机浏览器中打开司机端地址
   - 等待地图加载完成

2. **选择起点**
   - 点击"📍 定位"按钮获取GPS位置
   - 或从下拉列表选择"进场口1"

3. **选择终点**
   - 在地图上找到目标作业区节点
   - 直接点击节点，系统会自动设置为终点
   - 或从下拉列表选择终点节点

4. **设置车辆信息**
   - 选择车辆类型（如"渣土车"）
   - 输入载重和宽度（可选）
   - 输入车辆速度（可选）

5. **计算路线**
   - 点击"计算最优路线"按钮
   - 等待计算完成（通常几秒钟）

6. **查看路线**
   - 查看地图上显示的蓝色路线
   - 查看路线信息（预计时间、路径节点等）
   - 按照路线开始行驶

7. **GPS实时定位**（可选）
   - 保持GPS定位开启
   - 系统会实时显示车辆位置
   - 位置会自动吸附到道路上

---

## 常见问题

### Q1: 无法获取GPS位置怎么办？

**A**: 请检查以下几点：
- 浏览器是否允许了位置权限
- 设备的GPS功能是否开启
- 是否在室外或有GPS信号的地方
- 可以尝试刷新页面重新获取权限

### Q2: 如何在地图上选择终点？

**A**: 
1. 在地图上找到目标节点（节点上显示编号）
2. 直接点击节点
3. 系统会自动设置为终点并显示提示信息

### Q3: 路线计算失败怎么办？

**A**: 请检查：
- 起点和终点是否都已选择
- 起点和终点是否不同
- 网络连接是否正常
- 可以尝试重新计算

### Q4: 车辆位置不准确怎么办？

**A**: 
- GPS精度受环境影响，建议在开阔地带使用
- 系统会自动将位置吸附到最近的道路上
- 如果位置偏差较大，可以手动选择起点节点

### Q5: 如何切换语言？

**A**: 点击页面右上角的语言按钮，选择需要的语言（中文/English/Русский）。

### Q6: 路线显示不正确怎么办？

**A**: 
- 刷新页面重新加载地图
- 检查网络连接
- 联系管理员检查路网数据

### Q7: 可以使用GPS定位作为起点吗？

**A**: 可以！点击"📍 定位"按钮，系统会使用当前GPS位置作为起点，并自动找到最近的节点。

### Q8: 车辆位置会自动吸附到道路吗？

**A**: 是的！当GPS坐标接近道路（约5米内）时，系统会自动将位置吸附到最近的道路上，优先选择主路段。

### Q9: 如何查看详细路线信息？

**A**: 计算路线后，在"路线结果"区域会显示详细路径信息，包括经过的节点列表和预计时间。

### Q10: 可以保存常用路线吗？

**A**: 系统会自动记录历史路线，您可以在"历史记录"中查看之前计算的路线。

---

## 使用技巧

### 技巧1：快速选择终点

在地图上直接点击节点比从下拉列表选择更快更方便。

### 技巧2：GPS定位精度

在开阔地带使用GPS定位可以获得更高的精度。

### 技巧3：路线优化

如果对路线不满意，可以尝试调整车辆类型或速度设置，系统会重新计算路径。

### 技巧4：节省流量

如果网络不稳定，可以：
- 提前加载地图
- 使用WiFi连接
- 避免频繁刷新页面

---

## 技术支持

如遇到问题，请：
1. 检查网络连接
2. 刷新页面重试
3. 查看浏览器控制台（如有错误信息）
4. 联系系统管理员或技术支持

---

**版本**: v1.0  
**更新日期**: 2024年12月

